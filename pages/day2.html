<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jour 2 ‚Äî Introduction aux API REST | Web Services</title>
  <link rel="stylesheet" href="../styles/styles.css">
  <link rel="stylesheet" href="../styles/day2.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
      <div class="nav-logo">
        <img src="../assets/logo.jpeg" alt="YNOV Campus" class="logo-img">
        <span class="logo-text">APIs & Microservices</span>
      </div>
      <ul class="nav-menu">
        <li class="nav-item"><a href="../index.html" class="nav-link">Accueil</a></li>
        <li class="nav-item dropdown">
          <a href="#" class="nav-link dropdown-toggle">
            <i class="fas fa-calendar-alt"></i> Journ√©es
            <i class="fas fa-chevron-down"></i>
          </a>
          <div class="dropdown-menu">
            <a href="day1.html" class="dropdown-item">Jour 1 - Th√©orie</a>
            <a href="day1FilRouge.html" class="dropdown-item">Jour 1 - Fil Rouge</a>
            <a href="day2.html" class="dropdown-item active">Jour 2 - Th√©orie</a>
            <a href="day2FilRouge.html" class="dropdown-item">Jour 2 - Fil Rouge</a>
            <a href="day3.html" class="dropdown-item">Jour 3 - Th√©orie</a>
            <a href="day3FilRouge.html" class="dropdown-item">Jour 3 - Fil Rouge</a>
          </div>
        </li>
        <li class="nav-item"><a href="../index.html#projet" class="nav-link">Projet</a></li>
        <li class="nav-item"><a href="#atelier" class="nav-link">Atelier</a></li>
        <li class="nav-item"><a href="../index.html#contact" class="nav-link">Contact</a></li>
      </ul>
      <div class="hamburger">
        <span class="bar"></span>
        <span class="bar"></span>
        <span class="bar"></span>
      </div>
    </div>
  </nav>

  <!-- Hero -->
  <section class="hero" style="min-height: 60vh;">
    <div class="container">
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="hero-title">Jour 2</h1>
          <h2 class="hero-subtitle">Introduction aux API REST</h2>
          <p class="hero-description">
            D√©couvrez les 6 contraintes architecturales REST, apprenez √† concevoir des APIs √©l√©gantes, 
            et ma√Ætrisez l'art de la pagination et du filtrage.
          </p>
          <div class="hero-buttons">
            <a href="day2FilRouge.html" class="btn btn-primary"><i class="fas fa-code"></i>D√©marrer l'atelier</a>
            <a href="../index.html#programme" class="btn btn-secondary"><i class="fas fa-arrow-left"></i>Retour au programme</a>
          </div>
        </div>
        <div class="hero-image-container">
          <img src="../assets/webservices.jpg" alt="Web Services" class="hero-image">
        </div>
      </div>
    </div>
  </section>


  <!-- Objectifs -->
  <section class="introduction">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Objectifs d'apprentissage</h2>
      </div>
      <div class="intro-grid">
        <div class="intro-card">
          <div class="card-icon"><i class="fas fa-lightbulb"></i></div>
          <h3>Comprendre REST</h3>
          <p>Ma√Ætriser les 6 contraintes architecturales REST et leurs implications pratiques</p>
        </div>
        <div class="intro-card">
          <div class="card-icon"><i class="fas fa-pencil-ruler"></i></div>
          <h3>Design d'API RESTful</h3>
          <p>Concevoir des APIs avec des conventions de nommage et structure coh√©rentes</p>
        </div>
        <div class="intro-card">
          <div class="card-icon"><i class="fas fa-code"></i></div>
          <h3>Conception de r√©ponses</h3>
          <p>Structurer les r√©ponses JSON, g√©rer la pagination et les erreurs selon RFC 7807</p>
        </div>
        <div class="intro-card">
          <div class="card-icon"><i class="fas fa-tools"></i></div>
          <h3>Outils et bonnes pratiques</h3>
          <p>Utiliser les outils de d√©veloppement et appliquer les bonnes pratiques REST</p>
        </div>
      </div>
    </div>
  </section>

  <!-- Contenu de cours approfondi -->
  <section class="programme">
    <div class="container">
      <div class="section-header">
        <h2 class="section-title">Introduction aux API REST ‚Äî Cours d√©taill√©</h2>
        <p class="section-subtitle">Th√©orie compl√®te des API REST avec exemples concrets et bonnes pratiques</p>
      </div>

      <!-- Navigation vers Fil Rouge -->
      <div class="navigation-section">
        <div class="nav-buttons">
          <a href="day2FilRouge.html" class="nav-button">
            <i class="fas fa-code"></i> Fil Rouge J2
          </a>
        </div>
      </div>

      <div class="days-container">
        <div class="day-card expanded">
          <div class="day-header">
            <span class="day-number">1</span>
            <span class="day-theme">Principes REST</span>
          </div>
          <div class="day-content">
            <div class="day-morning">
              <h4><i class="fas fa-lightbulb"></i> REST : Une philosophie, pas un protocole</h4>
              <p>Hier, nous avons vu que REST dominait le paysage des APIs modernes. Mais qu'est-ce que REST exactement ? Beaucoup de d√©veloppeurs pensent que REST signifie simplement "utiliser HTTP avec du JSON". C'est r√©ducteur. REST est une philosophie architecturale compl√®te d√©finie par Roy Fielding dans sa th√®se de doctorat en 2000.</p>
              
              <p>L'histoire de cette th√®se est int√©ressante. Fielding √©tait l'un des principaux auteurs de la sp√©cification HTTP/1.1. Il observait comment le web √©voluait et comment les d√©veloppeurs utilisaient (et abusaient) du protocole HTTP. Il s'est demand√© : quels sont les principes architecturaux qui font que le web fonctionne si bien √† si grande √©chelle ? Sa r√©ponse : REST (REpresentational State Transfer).</p>
              
              <p>Le terme peut sembler abstrait, mais d√©composons-le. <strong>Representational</strong> signifie que vous manipulez des repr√©sentations de ressources, pas les ressources elles-m√™mes. Quand vous faites GET /users/123, vous ne r√©cup√©rez pas l'utilisateur en tant qu'entit√© r√©elle, vous r√©cup√©rez une repr√©sentation de cet utilisateur (probablement en JSON). <strong>State Transfer</strong> signifie que chaque requ√™te transf√®re l'√©tat n√©cessaire pour la traiter. Le serveur ne garde pas de m√©moire des requ√™tes pr√©c√©dentes.</p>

              <h4 class="mt-5"><i class="fas fa-cogs"></i> Les 6 contraintes architecturales REST</h4>
              <p>REST n'est pas une sp√©cification rigide avec des r√®gles √† suivre √† la lettre. Ce sont des contraintes architecturales, des principes directeurs. Une API peut √™tre "plus ou moins RESTful" selon combien de ces contraintes elle respecte.</p>

              <h5 class="mt-5">Contrainte 1 : Architecture Client-Serveur</h5>
              <p>Nous avons d√©j√† vu ce principe hier. Le client et le serveur sont s√©par√©s, avec des responsabilit√©s distinctes. Le client g√®re l'interface utilisateur et l'exp√©rience utilisateur. Le serveur g√®re les donn√©es, la logique m√©tier, et la persistance. Cette s√©paration permet aux deux d'√©voluer ind√©pendamment.</p>
              
              <p>Imaginons une banque qui a une application mobile pour ses clients. Le jour o√π elle d√©cide de refaire compl√®tement l'interface mobile avec un nouveau design, elle n'a pas besoin de toucher au serveur. Inversement, si elle migre sa base de donn√©es de MySQL √† PostgreSQL, l'application mobile continue de fonctionner sans changement.</p>

              <h5 class="mt-5">Contrainte 2 : Stateless (Sans √©tat)</h5>
              <p>C'est probablement la contrainte la plus importante et la plus mal comprise. Stateless signifie que chaque requ√™te du client vers le serveur doit contenir toutes les informations n√©cessaires pour comprendre et traiter cette requ√™te. Le serveur ne stocke aucun contexte de session c√¥t√© serveur entre deux requ√™tes.</p>
              
              <p>Prenons un exemple concret. Imaginons un site de e-commerce traditionnel non-RESTful des ann√©es 2000. Vous vous connectez, le serveur cr√©e une session et stocke votre ID utilisateur en m√©moire avec un cookie de session. Vous naviguez, ajoutez des articles au panier (stock√© en m√©moire serveur), puis vous passez commande. Tout fonctionne tant que vous parlez toujours au m√™me serveur. Mais si vous avez 10 serveurs derri√®re un load balancer et que votre deuxi√®me requ√™te arrive sur un serveur diff√©rent, celui-ci ne sait pas qui vous √™tes. Solution classique : sticky sessions, o√π le load balancer vous colle toujours au m√™me serveur. Mais √ßa complexifie la scalabilit√©.</p>
              
              <p><strong>Approche REST :</strong> chaque requ√™te contient un token d'authentification (comme un JWT). Le serveur n'a aucune session en m√©moire. Vous faites GET /cart avec votre token, le serveur d√©code le token, voit que vous √™tes l'utilisateur 123, va chercher votre panier en base de donn√©es, et vous le renvoie. Peu importe quel serveur traite la requ√™te, le r√©sultat sera le m√™me. Scaling horizontal trivial.</p>
              
              <p>Cette contrainte a un co√ªt : chaque requ√™te est l√©g√®rement plus grosse (il faut envoyer le token). Mais les b√©n√©fices en scalabilit√© et en simplicit√© sont √©normes. C'est pour √ßa que toutes les grandes plateformes (Google, Facebook, Amazon) utilisent cette approche.</p>

              <h5 class="mt-5">Contrainte 3 : Cacheable</h5>
              <p>Les r√©ponses du serveur doivent explicitement se d√©finir comme cacheable ou non-cacheable. Quand une r√©ponse est cacheable, le client (ou un proxy interm√©diaire comme un CDN) peut r√©utiliser cette r√©ponse pour des requ√™tes futures identiques, sans re-contacter le serveur.</p>
              
              <p>Imaginons un site de news. L'article que vous lisez maintenant ne va probablement pas changer dans les 5 prochaines minutes. Le serveur peut renvoyer cet article avec un header Cache-Control: max-age=300 (300 secondes = 5 minutes). Votre navigateur stocke cet article en cache local. Si vous actualisez la page dans les 5 minutes, le navigateur utilise sa copie locale sans faire de requ√™te r√©seau. R√©sultat : page qui se charge instantan√©ment, pas de charge sur le serveur.</p>
              
              <p>Les codes de statut HTTP ont √©t√© con√ßus pour supporter le caching. Rappelez-vous le 304 Not Modified que nous avons vu hier : le client demande "j'ai cette ressource dat√©e du 15 octobre, est-elle toujours valide ?", le serveur r√©pond "oui" avec un 304 et aucun body. √âconomie massive de bande passante.</p>

              <h5 class="mt-5">Contrainte 4 : Interface uniforme</h5>
              <p>C'est le c≈ìur de REST. L'interface entre le client et le serveur doit √™tre uniforme, standardis√©e. Cette contrainte se d√©compose en quatre sous-principes.</p>
              
              <p><strong>Identification des ressources :</strong> Chaque ressource est identifi√©e par une URI unique. /users/123 identifie l'utilisateur 123. /orders/456 identifie la commande 456. Cette URI est stable : elle ne change pas m√™me si la repr√©sentation de la ressource change.</p>
              
              <p><strong>Manipulation via repr√©sentations :</strong> Quand un client d√©tient une repr√©sentation d'une ressource avec suffisamment de m√©tadonn√©es, il a assez d'informations pour modifier ou supprimer cette ressource. Si vous faites GET /users/123 et que vous r√©cup√©rez l'utilisateur en JSON, vous avez tout ce qu'il faut pour faire ensuite PUT /users/123 avec les modifications.</p>
              
              <p><strong>Messages auto-descriptifs :</strong> Chaque message (requ√™te ou r√©ponse) contient assez d'informations pour d√©crire comment traiter ce message. Le header Content-Type: application/json dit au destinataire "ce body est du JSON, parse-le comme tel". Le code de statut dit "voil√† ce qui s'est pass√©". Les headers Cache-Control disent "voil√† comment cacher cette r√©ponse".</p>
              
              <p><strong>HATEOAS (Hypermedia As The Engine Of Application State) :</strong> C'est le principe le plus avanc√© et le moins impl√©ment√©. L'id√©e est que les r√©ponses contiennent des liens vers les actions possibles suivantes. Nous verrons √ßa en d√©tail dans la partie 3.</p>

              <h5 class="mt-5">Contrainte 5 : Syst√®me en couches</h5>
              <p>Le client ne peut pas savoir s'il est connect√© directement au serveur final ou √† un interm√©diaire. Vous pourriez avoir une architecture comme : Client ‚Üí CDN ‚Üí Load Balancer ‚Üí API Gateway ‚Üí Microservice ‚Üí Database. Du point de vue du client, il parle √† une seule entit√©.</p>
              
              <p>Cette contrainte permet d'ajouter des couches interm√©diaires (caching, s√©curit√©, load balancing) de mani√®re transparente. Imaginons que votre API devient victime de son succ√®s et re√ßoit trop de trafic. Vous pouvez ajouter un CDN Cloudflare devant sans changer une ligne de code c√¥t√© client. Le client continue de faire ses requ√™tes, mais maintenant Cloudflare cache les r√©ponses et absorbe 90% du trafic.</p>

              <h5 class="mt-5">Contrainte 6 : Code on demand (optionnel)</h5>
              <p>C'est la seule contrainte optionnelle. Le serveur peut √©tendre les fonctionnalit√©s du client en envoyant du code ex√©cutable (JavaScript, applets Java √† l'√©poque...). C'est exactement ce que font les applications web modernes : le serveur envoie du JavaScript que le navigateur ex√©cute.</p>
              
              <p>Cette contrainte est rarement mentionn√©e dans le contexte des APIs REST car elle est peu utilis√©e pour les APIs pures (qui renvoient des donn√©es, pas du code). Mais elle fait partie de la d√©finition originale de REST.</p>

              <h4 class="mt-5"><i class="fas fa-balance-scale"></i> Stateless vs Stateful : un d√©bat pragmatique</h4>
              <p>Le principe stateless est magnifique en th√©orie, mais la r√©alit√© est plus nuanc√©e. Certaines applications ont vraiment besoin d'√©tat. Imaginons une application de vid√©oconf√©rence en temps r√©el. Vous avez une connexion WebSocket ouverte avec le serveur pendant toute la dur√©e de l'appel. C'est intrins√®quement stateful. Le serveur maintient l'√©tat de votre connexion, sait qui est dans la salle, qui parle, etc.</p>
              
              <p>La solution pragmatique : √™tre stateless pour les op√©rations CRUD standard (cr√©er, lire, modifier, supprimer des ressources), et utiliser des m√©canismes stateful (WebSockets, Server-Sent Events) quand c'est vraiment n√©cessaire pour des fonctionnalit√©s temps r√©el. Vous pouvez m√™me avoir une API REST stateless pour la gestion des utilisateurs et des salles, et des WebSockets stateful pour la communication temps r√©el pendant l'appel.</p>

              <h4 class="mt-5"><i class="fas fa-database"></i> Ressources et URIs : penser en termes de "choses"</h4>
              <p>REST est centr√© sur les ressources. Une ressource est n'importe quelle information qui peut √™tre nomm√©e : un utilisateur, un document, une image, un service temporel (la m√©t√©o actuelle), une collection d'autres ressources, etc.</p>
              
              <p>La cl√© est de penser en termes de "choses" (noms) plut√¥t qu'en termes d'"actions" (verbes). Votre API expose des ressources que les clients peuvent manipuler avec les verbes HTTP standard.</p>

              <div class="highlight-box">
                <h6>üéØ Exemples de design</h6>
                <div class="comparison-examples">
                  <div class="bad-example">
                    <h6>‚ùå Mauvais design (orient√© actions)</h6>
                    <pre><code class="text">POST /createUser
POST /deleteUser?id=123
GET /getUserById?id=123
POST /updateUserEmail</code></pre>
                  </div>
                  <div class="good-example">
                    <h6>‚úÖ Bon design (orient√© ressources)</h6>
                    <pre><code class="text">POST /users          (cr√©er)
DELETE /users/123    (supprimer)
GET /users/123       (lire)
PATCH /users/123     (modifier)</code></pre>
                  </div>
                </div>
                <p>Dans le bon design, la ressource est /users et /users/123. Les actions sont exprim√©es par les verbes HTTP. C'est plus propre, plus coh√©rent, plus intuitif.</p>
              </div>
            </div>
          </div>
        </div>

        <div class="day-card expanded">
          <div class="day-header">
            <span class="day-number">2</span>
            <span class="day-theme">Design d'API RESTful</span>
          </div>
          <div class="day-content">
            <div class="day-morning">
              <h4><i class="fas fa-pencil-ruler"></i> Conventions de nommage des endpoints</h4>
              <p>Le nommage est crucial. Une bonne API doit √™tre intuitive. Un d√©veloppeur devrait pouvoir deviner les endpoints sans lire la documentation. Voici les conventions √©tablies.</p>

              <h5 class="mt-5">Utiliser des noms au pluriel</h5>
              <p>Toujours utiliser le pluriel pour les collections, m√™me quand on manipule une seule ressource.</p>
              
              <div class="code-comparison">
                <div class="good">
                  <h6>‚úÖ Bon</h6>
                  <pre><code class="text">GET /users/123
GET /products</code></pre>
                </div>
                <div class="bad">
                  <h6>‚ùå Mauvais</h6>
                  <pre><code class="text">GET /user/123
GET /product</code></pre>
                </div>
              </div>
              
              <p>Pourquoi ? Coh√©rence. Si /users liste tous les utilisateurs et /users/123 r√©cup√®re un utilisateur sp√©cifique, c'est logique. Si vous m√©langez /user/123 et /users, c'est confus.</p>
              
              <p><strong>Exception rare :</strong> les singletons. Si votre API a une ressource unique comme /profile (le profil de l'utilisateur connect√©), vous pouvez utiliser le singulier car il n'y a jamais de collection.</p>

              <h5 class="mt-5">Utiliser des noms, pas des verbes</h5>
              <div class="code-comparison">
                <div class="good">
                  <h6>‚úÖ Bon</h6>
                  <pre><code class="text">GET /users
POST /orders
DELETE /products/123</code></pre>
                </div>
                <div class="bad">
                  <h6>‚ùå Mauvais</h6>
                  <pre><code class="text">GET /getUsers
POST /createOrder
DELETE /deleteProduct/123</code></pre>
                </div>
              </div>
              
              <p>Le verbe est d√©j√† dans la m√©thode HTTP. Pas besoin de le r√©p√©ter dans l'URL.</p>
              
              <p><strong>Exception :</strong> les actions qui ne correspondent pas √† CRUD. Imaginons une action "r√©initialiser le mot de passe". Ce n'est ni un create, ni un update au sens strict. Vous pouvez cr√©er un endpoint POST /users/123/reset-password. Le verbe est accept√© quand l'action ne peut pas √™tre mod√©lis√©e simplement comme une op√©ration CRUD.</p>

              <h5 class="mt-5">Utiliser kebab-case pour les URLs</h5>
              <div class="code-comparison">
                <div class="good">
                  <h6>‚úÖ Bon</h6>
                  <pre><code class="text">/users/123/order-history</code></pre>
                </div>
                <div class="bad">
                  <h6>‚ùå Mauvais</h6>
                  <pre><code class="text">/users/123/orderHistory
/users/123/order_history</code></pre>
                </div>
              </div>
              
              <p>Les URLs sont case-insensitive techniquement, mais par convention on utilise kebab-case (tirets) en minuscules. C'est plus lisible dans les URLs.</p>

              <h4 class="mt-5"><i class="fas fa-sitemap"></i> Hi√©rarchie et ressources imbriqu√©es</h4>
              <p>Quand une ressource appartient clairement √† une autre, utilisez l'imbrication.</p>
              
              <div class="code-example">
                <pre><code class="text">GET /users/123/orders          # Les commandes de l'utilisateur 123
GET /orders/456/items          # Les articles de la commande 456
GET /posts/789/comments        # Les commentaires du post 789</code></pre>
              </div>
              
              <p>Mais attention √† ne pas trop imbriquer. Maximum 2-3 niveaux. Si vous vous retrouvez avec /users/123/orders/456/items/789/options/012, c'est ing√©rable. Dans ce cas, mettez les ressources au m√™me niveau et utilisez des query parameters pour filtrer.</p>
              
              <div class="code-comparison">
                <div class="good">
                  <h6>‚úÖ Bon</h6>
                  <code>GET /order-items/789?order_id=456</code>
                </div>
                <div class="bad">
                  <h6>‚ùå Mauvais</h6>
                  <code>GET /users/123/orders/456/items/789</code>
                </div>
              </div>

              <h4 class="mt-5"><i class="fas fa-route"></i> Structure des URLs : clart√© et coh√©rence</h4>
              <div class="pattern-box">
                <h5 class="mt-5">Pattern de base pour les collections</h5>
                <pre><code class="text">GET    /resources              # Liste toutes les ressources
POST   /resources              # Cr√©e une nouvelle ressource
GET    /resources/{id}         # R√©cup√®re une ressource sp√©cifique
PUT    /resources/{id}         # Remplace compl√®tement la ressource
PATCH  /resources/{id}         # Modifie partiellement la ressource
DELETE /resources/{id}         # Supprime la ressource</code></pre>
              </div>
              
              <p>C'est le pattern fondamental. Chaque collection dans votre API devrait suivre ce pattern.</p>

              <h5 class="mt-5">Gestion des actions complexes</h5>
              <p>Parfois, vous avez besoin d'actions qui ne rentrent pas dans le moule CRUD. Plusieurs approches existent.</p>
              
              <p><strong>Approche 1 : Sous-ressource</strong><br>
              Au lieu de voir une action comme un verbe, voyez-la comme une sous-ressource.</p>
              
              <div class="code-example">
                <pre><code class="text">POST /orders/123/payment        # Payer une commande
POST /users/456/activation      # Activer un utilisateur
POST /articles/789/publication  # Publier un article</code></pre>
              </div>
              
              <p>Ici, payment, activation, publication sont mod√©lis√©s comme des sous-ressources. Vous cr√©ez un paiement, vous cr√©ez une activation, vous cr√©ez une publication.</p>
              
              <p><strong>Approche 2 : Verbe explicite (dernier recours)</strong><br>
              Quand vraiment l'action ne peut pas √™tre mod√©lis√©e comme une ressource :</p>
              
              <div class="code-example">
                <pre><code class="text">POST /users/123/send-reset-email
POST /cart/calculate-shipping
POST /reports/generate</code></pre>
              </div>
              
              <p>C'est moins "pur" REST, mais c'est pragmatique. Mieux vaut une API claire avec quelques verbes qu'une API alambiqu√©e qui force tout dans le moule CRUD.</p>

              <h4 class="mt-5"><i class="fas fa-link"></i> Relations entre ressources</h4>
              <p>Les ressources sont rarement isol√©es. Un utilisateur a des commandes. Une commande a des articles. Un article appartient √† une cat√©gorie. Comment mod√©liser ces relations ?</p>

              <h5 class="mt-5">Relation one-to-many</h5>
              <p>Un utilisateur a plusieurs commandes. Deux approches principales.</p>
              
              <div class="relation-examples">
                <div class="relation-approach">
                  <h6>Approche 1 : Endpoint imbriqu√©</h6>
                  <code>GET /users/123/orders</code>
                  <p><strong>Avantages :</strong> Clair, explicite.</p>
                  <p><strong>Inconv√©nients :</strong> Si un m√™me ordre peut appartenir √† plusieurs utilisateurs (ex: commande group√©e), √ßa devient compliqu√©.</p>
                </div>
                <div class="relation-approach">
                  <h6>Approche 2 : Query parameter</h6>
                  <code>GET /orders?user_id=123</code>
                  <p><strong>Avantages :</strong> Flexible, permet des filtres multiples.</p>
                  <p><strong>Inconv√©nients :</strong> Moins explicite sur la relation.</p>
                </div>
              </div>
              
              <p>Choisissez l'approche 1 pour les relations fortes et √©videntes. Choisissez l'approche 2 pour plus de flexibilit√©.</p>

              <h5 class="mt-5">Relation many-to-many</h5>
              <p>Un √©tudiant suit plusieurs cours. Un cours a plusieurs √©tudiants. Comment g√©rer √ßa ?</p>
              
              <div class="relation-examples">
                <div class="relation-approach">
                  <h6>Option 1 : Sous-ressource dans les deux sens</h6>
                  <pre><code class="text">GET /students/123/courses       # Les cours de l'√©tudiant 123
GET /courses/456/students       # Les √©tudiants du cours 456</code></pre>
                </div>
                <div class="relation-approach">
                  <h6>Option 2 : Ressource interm√©diaire</h6>
                  <pre><code class="text">GET /enrollments?student_id=123    # Toutes les inscriptions de l'√©tudiant 123
GET /enrollments?course_id=456     # Toutes les inscriptions au cours 456
POST /enrollments                  # Cr√©er une nouvelle inscription</code></pre>
                </div>
              </div>
              
              <p>Si la relation elle-m√™me a des attributs (ex: date d'inscription, note), cr√©ez une ressource d√©di√©e. Un enrollment contient student_id, course_id, enrollment_date, grade, etc.</p>

              <h5 class="mt-5">Inclusion de ressources li√©es</h5>
              <p>Parfois, le client veut la ressource principale ET les ressources li√©es en une seule requ√™te. Utilisez un query parameter include ou expand.</p>
              
              <div class="code-example">
                <pre><code class="text">GET /users/123?include=orders,profile</code></pre>
              </div>
              
              <p>R√©ponse :</p>
              <div class="json-example">
                <pre><code>{
  "id": 123,
  "name": "Marie Dubois",
  "orders": [
    {"id": 1, "total": 99.99},
    {"id": 2, "total": 149.99}
  ],
  "profile": {
    "bio": "...",
    "avatar": "..."
  }
}</code></pre>
              </div>
              
              <p>C'est pratique pour r√©duire le nombre de requ√™tes, mais attention : ne r√©cup√©rez que ce qui est n√©cessaire. Si vous incluez trop de donn√©es, les performances se d√©gradent.</p>

              <h4 class="mt-5"><i class="fas fa-tools"></i> Utilisation appropri√©e des m√©thodes HTTP</h4>
              <p>Nous avons vu les m√©thodes hier, mais insistons sur quelques cas d'usage sp√©cifiques dans le contexte REST.</p>

              <h5 class="mt-5">POST vs PUT : une source de confusion</h5>
              <p>R√®gle simple :</p>
              <ul>
                <li><strong>POST</strong> pour cr√©er une ressource quand le serveur g√©n√®re l'ID</li>
                <li><strong>PUT</strong> pour cr√©er ou remplacer une ressource quand le client fournit l'ID</li>
              </ul>
              
              <p><strong>Cas classique :</strong> cr√©ation d'utilisateur.</p>
              
              <div class="code-example">
                <pre><code class="text">POST /users
Body: {"name": "Marie", "email": "marie@example.com"}

R√©ponse 201 Created:
Location: /users/550e8400-e29b-41d4-a716-446655440000
Body: {"id": "550e8400...", "name": "Marie", ...}</code></pre>
              </div>
              
              <p>Le serveur a g√©n√©r√© l'ID (UUID). On utilise POST.</p>
              
              <p><strong>Cas rare :</strong> cr√©ation avec ID fourni par le client.</p>
              
              <div class="code-example">
                <pre><code class="text">PUT /users/marie-dubois
Body: {"name": "Marie", "email": "marie@example.com"}</code></pre>
              </div>
              
              <p>Le client choisit l'ID (ici marie-dubois comme username). On utilise PUT. Si la ressource existe d√©j√†, elle est remplac√©e (idempotence de PUT).</p>

              <h5 class="mt-5">PATCH : subtilit√©s</h5>
              <p>PATCH modifie partiellement. Mais comment sp√©cifier exactement quoi modifier ? Deux approches.</p>
              
              <p><strong>Approche 1 : Merge patch (simple)</strong><br>
              Vous envoyez uniquement les champs √† modifier.</p>
              
              <div class="code-example">
                <pre><code class="text">PATCH /users/123
Body: {"email": "new-email@example.com"}</code></pre>
              </div>
              
              <p>Le serveur merge ce JSON avec la ressource existante. Simple, mais limit√© : vous ne pouvez pas supprimer un champ (mettre √† null), vous ne pouvez pas modifier des √©l√©ments dans un tableau pr√©cis√©ment.</p>
              
              <p><strong>Approche 2 : JSON Patch (puissant)</strong><br>
              Format standardis√© (RFC 6902) qui permet des op√©rations pr√©cises.</p>
              
              <div class="code-example">
                <pre><code class="text">PATCH /users/123
Content-Type: application/json-patch+json
Body:
[
  {"op": "replace", "path": "/email", "value": "new@example.com"},
  {"op": "add", "path": "/roles/-", "value": "admin"},
  {"op": "remove", "path": "/temporary_field"}
]</code></pre>
              </div>
              
              <p>Op√©rations : add, remove, replace, move, copy, test. Tr√®s puissant, mais plus complexe.</p>
              
              <p>Pour la plupart des APIs, le merge patch simple suffit. Utilisez JSON Patch pour des cas avanc√©s.</p>
            </div>
          </div>
        </div>

        <div class="day-card expanded">
          <div class="day-header">
            <span class="day-number">3</span>
            <span class="day-theme">Conception de r√©ponses API</span>
          </div>
          <div class="day-content">
            <div class="day-morning">
              <h4><i class="fas fa-code"></i> Structure des r√©ponses JSON</h4>
              <p>Une r√©ponse API bien structur√©e facilite la vie des d√©veloppeurs. √âtablissons des conventions.</p>

              <h5 class="mt-5">R√©ponse pour une ressource unique</h5>
              <div class="json-example">
                <pre><code>{
  "id": "550e8400-e29b-41d4-a716-446655440000",
  "name": "Marie Dubois",
  "email": "marie@example.com",
  "created_at": "2025-10-24T14:30:00Z",
  "updated_at": "2025-10-25T09:15:00Z"
}</code></pre>
              </div>
              
              <p>Simple, direct. Le body est directement l'objet.</p>

              <h5 class="mt-5">R√©ponse pour une collection</h5>
              <p>Ne renvoyez JAMAIS un tableau nu au top-level. Enveloppez toujours dans un objet.</p>
              
              <div class="json-comparison">
                <div class="bad-json">
                  <h6>‚ùå Mauvais :</h6>
                  <pre><code>[
  {"id": 1, "name": "Product A"},
  {"id": 2, "name": "Product B"}
]</code></pre>
                </div>
                <div class="good-json">
                  <h6>‚úÖ Bon :</h6>
                  <pre><code>{
  "data": [
    {"id": 1, "name": "Product A"},
    {"id": 2, "name": "Product B"}
  ],
  "meta": {
    "total": 156,
    "page": 1,
    "per_page": 20
  }
}</code></pre>
                </div>
              </div>
              
              <p>Pourquoi ? Flexibilit√© future. Si demain vous voulez ajouter des m√©tadonn√©es (pagination, statistiques, etc.), vous pouvez. Avec un tableau nu, vous cassez la compatibilit√©.</p>

              <h5 class="mt-5">M√©tadonn√©es utiles</h5>
              <div class="json-example">
                <pre><code>{
  "data": [...],
  "meta": {
    "total": 156,          // Nombre total d'√©l√©ments
    "count": 20,           // Nombre d'√©l√©ments dans cette page
    "page": 1,             // Page actuelle
    "per_page": 20,        // √âl√©ments par page
    "total_pages": 8       // Nombre total de pages
  },
  "links": {
    "self": "/products?page=1",
    "next": "/products?page=2",
    "last": "/products?page=8"
  }
}</code></pre>
              </div>
              
              <p>Ces m√©tadonn√©es permettent au client de construire une pagination UI facilement.</p>

              <h4 class="mt-5"><i class="fas fa-list-ol"></i> Pagination : g√©rer les grandes collections</h4>
              <p>Renvoyer 10,000 produits en une seule r√©ponse, c'est inacceptable. Temps de r√©ponse long, consommation m√©moire excessive, mauvaise UX. La pagination est essentielle.</p>

              <h5 class="mt-5">Pagination offset-based (classique)</h5>
              <div class="code-example">
                <pre><code class="text">GET /products?page=1&per_page=20
GET /products?offset=40&limit=20</code></pre>
              </div>
              
              <p>Deux variantes. Premi√®re : num√©ro de page + taille de page. Deuxi√®me : offset (nombre d'√©l√©ments √† sauter) + limit (nombre √† r√©cup√©rer).</p>
              
              <p><strong>Avantages :</strong> Simple, permet de sauter √† n'importe quelle page directement.</p>
              <p><strong>Inconv√©nients :</strong> Performance qui se d√©grade sur les grandes tables (offset 10000 est lent en SQL), probl√®mes si des √©l√©ments sont ajout√©s/supprim√©s pendant la pagination.</p>
              
              <p>Imaginons que vous consultez la page 1 (√©l√©ments 1-20). Puis 100 nouveaux produits sont ajout√©s en t√™te de liste. Quand vous demandez la page 2, vous obtenez des √©l√©ments que vous avez d√©j√† vus sur la page 1. Probl√®me de coh√©rence.</p>

              <h5 class="mt-5">Pagination cursor-based (moderne)</h5>
              <div class="code-example">
                <code>GET /products?cursor=eyJpZCI6MTIzfQ==&limit=20</code>
              </div>
              
              <p>Le cursor est un pointeur opaque (g√©n√©ralement encod√© en base64) qui identifie o√π vous en √™tes. Le serveur renvoie le cursor du prochain batch.</p>
              
              <div class="json-example">
                <pre><code>{
  "data": [...],
  "meta": {
    "next_cursor": "eyJpZCI6MTQzfQ==",
    "has_more": true
  }
}</code></pre>
              </div>
              
              <p><strong>Avantages :</strong> Performance constante quelle que soit la position, coh√©rence m√™me si des donn√©es sont ajout√©es/supprim√©es.</p>
              <p><strong>Inconv√©nients :</strong> Ne permet pas de sauter directement √† la page 5, plus complexe √† impl√©menter.</p>
              
              <p>Utilisez offset-based pour des cas simples (backoffice admin, recherches ponctuelles). Utilisez cursor-based pour des feeds infinis (r√©seaux sociaux, messagerie, applications temps r√©el).</p>

              <h5 class="mt-5">Limites raisonnables</h5>
              <p>Imposez des limites. Ne laissez pas le client demander ?limit=1000000.</p>
              
              <div class="code-example">
                <code>per_page = min(request.get('per_page', 20), 100)  # Max 100 par page</code>
              </div>
              
              <p>Si le client demande 1000, clamp √† 100 et documentez cette limite.</p>

              <h4 class="mt-5"><i class="fas fa-filter"></i> Filtrage et tri</h4>
              <p>Les clients ont souvent besoin de filtrer et trier les collections.</p>

              <h5 class="mt-5">Filtrage basique</h5>
              <p>Utilisez des query parameters.</p>
              
              <div class="code-example">
                <pre><code class="text">GET /products?category=electronics
GET /products?min_price=100&max_price=500
GET /products?in_stock=true
GET /users?status=active&role=admin</code></pre>
              </div>
              
              <p>Convention : le nom du query parameter correspond au nom du champ. Simple et intuitif.</p>

              <h5 class="mt-5">Filtrage avanc√©</h5>
              <p>Pour des filtres complexes, utilisez une syntaxe structur√©e.</p>
              
              <div class="code-example">
                <code>GET /products?filter[category]=electronics&filter[price][gte]=100&filter[price][lte]=500</code>
              </div>
              
              <p>gte = greater than or equal, lte = less than or equal. Cette syntaxe permet des filtres riches sans ambigu√Øt√©.</p>

              <h5 class="mt-5">Recherche textuelle</h5>
              <div class="code-example">
                <pre><code class="text">GET /products?search=laptop
GET /users?q=marie</code></pre>
              </div>
              
              <p>search ou q pour une recherche full-text. Le serveur cherche dans plusieurs champs (nom, description, tags...).</p>

              <h5 class="mt-5">Tri</h5>
              <div class="code-example">
                <pre><code class="text">GET /products?sort=price            # Tri ascendant par prix
GET /products?sort=-price           # Tri descendant par prix (le - indique desc)
GET /products?sort=category,price   # Tri multiple : par cat√©gorie puis prix</code></pre>
              </div>
              
              <p>Convention : - pr√©fixe pour descendant, , pour s√©parer plusieurs crit√®res.</p>

              <h4 class="mt-5"><i class="fas fa-exclamation-triangle"></i> Gestion des erreurs : RFC 7807 Problem Details</h4>
              <p>Hier, nous avons vu les codes de statut HTTP. Mais le code seul ne suffit pas. Le client a besoin de d√©tails : qu'est-ce qui a √©chou√© exactement ? Comment corriger ?</p>
              
              <p>Il existe un standard RFC 7807 "Problem Details for HTTP APIs" qui d√©finit un format JSON pour les erreurs.</p>

              <h5 class="mt-5">Format RFC 7807</h5>
              <div class="json-example">
                <pre><code>{
  "type": "https://api.example.com/errors/validation-error",
  "title": "Validation Failed",
  "status": 422,
  "detail": "The email address is already in use by another account.",
  "instance": "/users",
  "correlation_id": "550e8400-e29b-41d4-a716-446655440000",
  "invalid_fields": [
    {
      "field": "email",
      "message": "Email already exists"
    }
  ]
}</code></pre>
              </div>
              
              <p>D√©composons :</p>
              <ul>
                <li><strong>type :</strong> URI qui identifie le type d'erreur. Id√©alement, cette URI pointe vers une documentation.</li>
                <li><strong>title :</strong> Titre human-readable du probl√®me. G√©n√©rique pour ce type d'erreur.</li>
                <li><strong>status :</strong> Le code de statut HTTP (r√©p√©t√© pour commodit√©).</li>
                <li><strong>detail :</strong> Explication sp√©cifique de cette instance du probl√®me.</li>
                <li><strong>instance :</strong> URI de la requ√™te qui a caus√© l'erreur.</li>
                <li><strong>correlation_id :</strong> ID unique pour tracer cette erreur dans vos logs (crucial pour le debugging).</li>
                <li><strong>Champs custom :</strong> Vous pouvez ajouter des champs suppl√©mentaires comme invalid_fields.</li>
              </ul>

              <h5 class="mt-5">Content-Type</h5>
              <p>Important : utilisez Content-Type: application/problem+json pour les erreurs RFC 7807, pas application/json. √áa permet au client de savoir qu'il re√ßoit une erreur structur√©e.</p>

              <h5 class="mt-5">Exemples d'erreurs courantes</h5>
              
              <div class="error-example">
                <h6>400 Bad Request - JSON invalide</h6>
                <pre><code>{
  "type": "https://api.example.com/errors/invalid-json",
  "title": "Invalid JSON",
  "status": 400,
  "detail": "Unexpected token < in JSON at position 0",
  "instance": "/users",
  "correlation_id": "123e4567-e89b-12d3-a456-426614174000"
}</code></pre>
              </div>
              
              <div class="error-example">
                <h6>401 Unauthorized - Token manquant</h6>
                <pre><code>{
  "type": "https://api.example.com/errors/unauthorized",
  "title": "Unauthorized",
  "status": 401,
  "detail": "No authentication token provided. Please include an Authorization header.",
  "instance": "/users/123",
  "correlation_id": "223e4567-e89b-12d3-a456-426614174000"
}</code></pre>
              </div>
              
              <div class="error-example">
                <h6>403 Forbidden - Permissions insuffisantes</h6>
                <pre><code>{
  "type": "https://api.example.com/errors/forbidden",
  "title": "Forbidden",
  "status": 403,
  "detail": "You do not have permission to delete this user. Admin role required.",
  "instance": "/users/123",
  "correlation_id": "323e4567-e89b-12d3-a456-426614174000",
  "required_role": "admin",
  "current_role": "user"
}</code></pre>
              </div>
              
              <div class="error-example">
                <h6>404 Not Found - Ressource inexistante</h6>
                <pre><code>{
  "type": "https://api.example.com/errors/not-found",
  "title": "Not Found",
  "status": 404,
  "detail": "User with ID 999 does not exist.",
  "instance": "/users/999",
  "correlation_id": "423e4567-e89b-12d3-a456-426614174000"
}</code></pre>
              </div>
              
              <div class="error-example">
                <h6>422 Unprocessable Entity - Validation m√©tier</h6>
                <pre><code>{
  "type": "https://api.example.com/errors/validation-error",
  "title": "Validation Failed",
  "status": 422,
  "detail": "One or more fields failed validation.",
  "instance": "/users",
  "correlation_id": "523e4567-e89b-12d3-a456-426614174000",
  "errors": [
    {
      "field": "email",
      "code": "email_already_exists",
      "message": "This email address is already registered."
    },
    {
      "field": "password",
      "code": "password_too_weak",
      "message": "Password must contain at least 8 characters, including uppercase, lowercase, and numbers."
    }
  ]
}</code></pre>
              </div>
              
              <div class="error-example">
                <h6>500 Internal Server Error - Erreur serveur</h6>
                <pre><code>{
  "type": "https://api.example.com/errors/internal-error",
  "title": "Internal Server Error",
  "status": 500,
  "detail": "An unexpected error occurred while processing your request. Our team has been notified.",
  "instance": "/orders/123/payment",
  "correlation_id": "623e4567-e89b-12d3-a456-426614174000"
}</code></pre>
              </div>
              
              <p><strong>Note importante :</strong> pour les 500, ne r√©v√©lez JAMAIS les d√©tails techniques (stack traces, messages d'exception bruts). Ces informations vont dans les logs serveur, pas dans la r√©ponse au client. C'est une faille de s√©curit√© de r√©v√©ler des d√©tails d'impl√©mentation.</p>

              <h5 class="mt-5">Coh√©rence des erreurs</h5>
              <p>Toutes vos erreurs doivent suivre le m√™me format. Si une endpoint renvoie une structure d'erreur et une autre endpoint une structure diff√©rente, c'est cauchemardesque pour le client qui doit g√©rer plusieurs formats.</p>
              
              <p>Cr√©ez des fonctions helper r√©utilisables pour g√©n√©rer vos erreurs.</p>
              
              <div class="code-example">
                <pre><code class="javascript">// Node.js/Express exemple
function problemDetails(type, title, status, detail, instance, extra = {}) {
  return {
    type: `https://api.example.com/errors/${type}`,
    title,
    status,
    detail,
    instance,
    correlation_id: uuidv4(),
    ...extra
  };
}

// Utilisation
res.status(422)
   .type('application/problem+json')
   .json(problemDetails(
     'validation-error',
     'Validation Failed',
     422,
     'Email already exists',
     req.path,
     { errors: [{field: 'email', message: 'Email already exists'}] }
   ));</code></pre>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <div class="footer-logo">
            <img src="../assets/logo.jpeg" alt="YNOV Campus" class="footer-logo-img">
            <span class="footer-logo-text">Web Services</span>
          </div>
          <p class="footer-description">Jour 2 ‚Äî Introduction aux API REST.</p>
        </div>
        <div class="footer-section">
          <h3>Navigation</h3>
          <ul>
            <li><a href="../index.html#programme">Programme</a></li>
            <li><a href="../index.html#projet">Projet</a></li>
            <li><a href="#atelier">Atelier J2</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Ressources</h3>
          <ul>
            <li>REST Principles</li>
            <li>OpenAPI</li>
            <li>Postman</li>
          </ul>
        </div>
        <div class="footer-section">
          <h3>Contact</h3>
          <div class="contact-info">
            <p><i class="fas fa-envelope"></i> contact@ynov.com</p>
            <p><i class="fas fa-map-marker-alt"></i> Campus Ynov</p>
          </div>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 YNOV Campus. Tous droits r√©serv√©s.</p>
      </div>
    </div>
  </footer>

  <script src="../script.js"></script>
  
  <!-- highlight.js pour la coloration syntaxique -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    // Auto-d√©tection et coloration de tous les blocs de code
    document.addEventListener('DOMContentLoaded', function() {
      hljs.highlightAll();
    });
  </script>
</body>
</html>
