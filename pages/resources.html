<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ressources ‚Äî Gestion des Cl√©s API</title>
  <link rel="stylesheet" href="../styles/styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
</head>
<body>
  <!-- Navigation -->
  <nav class="navbar">
    <div class="nav-container">
        <div class="nav-logo">
            <img src="../assets/logo.jpeg" alt="YNOV Campus" class="logo-img">
            <span class="logo-text">Web Services</span>
        </div>
        <ul class="nav-menu">
            <li class="nav-item">
                <a href="../index.html" class="nav-link">Accueil</a>
            </li>
            <li class="nav-item">
                <a href="../index.html#programme" class="nav-link">Programme</a>
            </li>
            <li class="nav-item">
                <a href="../index.html#projet" class="nav-link">Projet SmartCity</a>
            </li>
            <li class="nav-item dropdown">
                <a href="#" class="nav-link dropdown-toggle">
                    <i class="fas fa-calendar-alt"></i> Journ√©es
                    <i class="fas fa-chevron-down"></i>
                </a>
                <div class="dropdown-menu">
                    <a href="day1.html" class="dropdown-item">Jour 1 - Th√©orie</a>
                    <a href="day1FilRouge.html" class="dropdown-item">Jour 1 - Fil Rouge</a>
                    <a href="day2.html" class="dropdown-item">Jour 2 - Th√©orie</a>
                    <a href="day2FilRouge.html" class="dropdown-item">Jour 2 - Fil Rouge</a>
                    <a href="day3.html" class="dropdown-item">Jour 3 - Th√©orie</a>
                    <a href="day3FilRouge.html" class="dropdown-item">Jour 3 - Fil Rouge</a>
                </div>
            </li>
            <li class="nav-item">
                <a href="resources.html" class="nav-link active">Ressources</a>
            </li>
            <li class="nav-item">
                <a href="../index.html#contact" class="nav-link">Contact</a>
            </li>
        </ul>
        <div class="hamburger">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
    </div>
</nav>

  <!-- Hero -->
  <section class="hero" style="min-height: 40vh;">
    <div class="container">
      <div class="hero-content">
        <div class="hero-text">
          <h1 class="hero-title">Ressources</h1>
          <h2 class="hero-subtitle">Gestion S√©curis√©e des Cl√©s API</h2>
          <p class="hero-description">
            Guide complet pour g√©n√©rer, stocker et utiliser des cl√©s API de mani√®re s√©curis√©e dans vos applications.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Contenu principal -->
  <section class="programme">
    <div class="container">
      <div class="day-card expanded">
        <div class="day-header">
          <span class="day-number">üîë</span>
          <span class="day-theme">Gestion des Cl√©s API</span>
        </div>
        <div class="day-content">
          <!-- G√©n√©ration -->
          <h4 class="mt-5"><i class="fas fa-key"></i> G√©n√©ration de la cl√© API</h4>
          <h5>Caract√©ristiques d'une bonne cl√© API</h5>
          <ul>
            <li><strong>Longueur minimale :</strong> 32 caract√®res</li>
            <li><strong>Caract√®res al√©atoires :</strong> Utiliser des caract√®res alphanum√©riques + symboles</li>
            <li><strong>Impr√©visible :</strong> G√©n√©r√©e avec un g√©n√©rateur cryptographiquement s√©curis√©</li>
          </ul>

          <h5 class="mt-4">Exemple de g√©n√©ration (Node.js)</h5>
          <pre><code class="javascript">const crypto = require('crypto');

function generateApiKey() {
  return crypto.randomBytes(32).toString('hex');
  // G√©n√®re une cl√© de 64 caract√®res hexad√©cimaux
}</code></pre>

          <h5 class="mt-4">Format recommand√©</h5>
          <p><strong>Pr√©fixe identifiable + cl√© al√©atoire</strong></p>
          <p>Exemple : <code>sk_live_a3f8d9c2b1e4f5a6d7c8b9e0f1a2b3c4</code></p>

          <!-- Section 2: Stockage -->
          <h4 class="mt-5"><i class="fas fa-database"></i> Stockage s√©curis√©</h4>
          <div class="highlight-box" style="background: #fee; border-left: 4px solid #f00;">
            <h6>‚ö†Ô∏è Ne JAMAIS stocker la cl√© en clair</h6>
          </div>

          <h5 class="mt-4">Mauvaise pratique ‚ùå</h5>
          <pre><code class="sql">INSERT INTO api_keys (key, user_id) 
VALUES ('sk_live_abc123...', 1);</code></pre>

          <h5 class="mt-4">Bonne pratique ‚úÖ</h5>
          <pre><code class="javascript">const crypto = require('crypto');

function hashApiKey(apiKey) {
  return crypto
    .createHash('sha256')
    .update(apiKey)
    .digest('hex');
}

// Stockage
const hashedKey = hashApiKey(apiKey);
// Stocker hashedKey dans la base de donn√©es</code></pre>

          <h5 class="mt-4">Structure de table recommand√©e</h5>
          <pre><code class="sql">CREATE TABLE api_keys (
  id SERIAL PRIMARY KEY,
  key_hash VARCHAR(64) NOT NULL UNIQUE,
  user_id INTEGER NOT NULL,
  name VARCHAR(100),
  created_at TIMESTAMP DEFAULT NOW(),
  last_used_at TIMESTAMP,
  expires_at TIMESTAMP,
  is_active BOOLEAN DEFAULT true
);</code></pre>

          <!-- Section 3: Mise √† disposition -->
          <h4 class="mt-5"><i class="fas fa-user-check"></i> Mise √† disposition au client</h4>
          <h5>Affichage unique lors de la cr√©ation</h5>
          <div class="highlight-box" style="background: #efe; border-left: 4px solid #0a0;">
            <h6>‚úÖ Cl√© API cr√©√©e avec succ√®s !</h6>
            <p><code style="font-family: monospace; background: #f5f5f5; padding: 0.5rem;">sk_live_a3f8d9c2b1e4f5a6d7c8b9e0f1a2b3c4</code></p>
            <h6>‚ö†Ô∏è IMPORTANT :</h6>
            <ul>
              <li>Copiez cette cl√© maintenant</li>
              <li>Elle ne sera plus affich√©e</li>
              <li>Conservez-la en lieu s√ªr</li>
            </ul>
          </div>

          <h5 class="mt-4">API de cr√©ation</h5>
          <pre><code class="javascript">// POST /api/keys
{
  "name": "Cl√© de production",
  "expires_in_days": 365
}

// R√©ponse
{
  "api_key": "sk_live_a3f8d9c2b1e4f5a6d7c8b9e0f1a2b3c4",
  "name": "Cl√© de production",
  "created_at": "2025-10-28T10:30:00Z",
  "expires_at": "2026-10-28T10:30:00Z",
  "message": "Sauvegardez cette cl√©, elle ne sera plus affich√©e"
}</code></pre>

          <!-- Section 4: V√©rification -->
          <h4 class="mt-5"><i class="fas fa-shield-alt"></i> V√©rification de la cl√©</h4>
          <h5>Middleware de v√©rification (Express.js)</h5>
          <pre><code class="javascript">async function verifyApiKey(req, res, next) {
  // 1. Extraire la cl√© du header
  const apiKey = req.headers['x-api-key'] || 
                 req.headers['authorization']?.replace('Bearer ', '');
  
  if (!apiKey) {
    return res.status(401).json({ 
      error: 'Cl√© API manquante' 
    });
  }

  // 2. Hasher la cl√© re√ßue
  const hashedKey = hashApiKey(apiKey);

  // 3. Rechercher dans la base de donn√©es
  const key = await db.query(
    `SELECT * FROM api_keys 
     WHERE key_hash = $1 
     AND is_active = true 
     AND (expires_at IS NULL OR expires_at > NOW())`,
    [hashedKey]
  );

  if (!key) {
    return res.status(401).json({ 
      error: 'Cl√© API invalide ou expir√©e' 
    });
  }

  // 4. Mettre √† jour la derni√®re utilisation
  await db.query(
    'UPDATE api_keys SET last_used_at = NOW() WHERE id = $1',
    [key.id]
  );

  // 5. Ajouter l'utilisateur au contexte
  req.user = key.user_id;
  next();
}

// Utilisation
app.get('/api/data', verifyApiKey, (req, res) => {
  // Route prot√©g√©e
});</code></pre>

          <!-- Section 5: Bonnes pratiques -->
          <h4 class="mt-5"><i class="fas fa-lock"></i> Bonnes pratiques de s√©curit√©</h4>
          <h5>Limitation de d√©bit (Rate Limiting)</h5>
          <pre><code class="javascript">const rateLimit = require('express-rate-limit');

const apiLimiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15 minutes
  max: 100, // 100 requ√™tes max
  keyGenerator: (req) => req.user, // Par utilisateur
  message: 'Trop de requ√™tes, r√©essayez plus tard'
});

app.use('/api/', apiLimiter);</code></pre>

          <h5 class="mt-4">Rotation des cl√©s</h5>
          <ul>
            <li>Permettre aux clients de g√©n√©rer de nouvelles cl√©s</li>
            <li>P√©riode de transition avec deux cl√©s actives</li>
            <li>Notification avant expiration</li>
          </ul>

          <h5 class="mt-4">Surveillance</h5>
          <ul>
            <li>Logger les tentatives d'acc√®s √©chou√©es</li>
            <li>Alerter sur les comportements suspects</li>
            <li>R√©voquer automatiquement apr√®s X √©checs cons√©cutifs</li>
          </ul>

          <!-- Section 6: Documentation -->
          <h4 class="mt-5"><i class="fas fa-book"></i> Documentation pour les clients</h4>
          <h5>Comment utiliser la cl√© API</h5>
          
          <h5 class="mt-4">En-t√™te HTTP recommand√©</h5>
          <pre><code class="bash">curl -H "X-API-Key: sk_live_votre_cle_ici" \
     https://api.votreservice.com/data</code></pre>

          <p>Ou avec Bearer token</p>
          <pre><code class="bash">curl -H "Authorization: Bearer sk_live_votre_cle_ici" \
     https://api.votreservice.com/data</code></pre>

          <h5 class="mt-4">Codes d'erreur</h5>
          <ul>
            <li><strong>401 :</strong> Cl√© manquante ou invalide</li>
            <li><strong>403 :</strong> Cl√© valide mais acc√®s refus√© √† cette ressource</li>
            <li><strong>429 :</strong> Limite de d√©bit d√©pass√©e</li>
          </ul>

          <!-- Section 7: Gestion c√¥t√© client -->
          <h4 class="mt-5"><i class="fas fa-list"></i> Gestion des cl√©s c√¥t√© client</h4>
          <h5>Liste des cl√©s actives</h5>
          <pre><code class="text">GET /api/keys

R√©ponse :
[
  {
    "id": 1,
    "name": "Cl√© de production",
    "prefix": "sk_live_a3f8",
    "created_at": "2025-10-28T10:30:00Z",
    "last_used_at": "2025-10-28T15:20:00Z",
    "expires_at": "2026-10-28T10:30:00Z"
  }
]</code></pre>

          <h5 class="mt-4">R√©vocation d'une cl√©</h5>
          <pre><code class="text">DELETE /api/keys/:id

R√©ponse :
{
  "message": "Cl√© r√©voqu√©e avec succ√®s"
}</code></pre>

          <!-- Checklist -->
          <h4 class="mt-5"><i class="fas fa-check-square"></i> Checklist de s√©curit√©</h4>
          <div class="highlight-box">
            <ul style="list-style: none; padding-left: 0;">
              <li>‚úì Les cl√©s sont g√©n√©r√©es de mani√®re cryptographiquement s√©curis√©e</li>
              <li>‚úì Les cl√©s sont hash√©es avant stockage (jamais en clair)</li>
              <li>‚úì La cl√© n'est affich√©e qu'une seule fois lors de la cr√©ation</li>
              <li>‚úì Limitation du nombre de requ√™tes par cl√©</li>
              <li>‚úì Logging des acc√®s et tentatives √©chou√©es</li>
              <li>‚úì Possibilit√© de r√©voquer une cl√©</li>
              <li>‚úì Expiration automatique des cl√©s</li>
              <li>‚úì Communication HTTPS uniquement</li>
              <li>‚úì Documentation claire pour les d√©veloppeurs</li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Nouvelle ressource : D√©ploiement sur Render -->
      <div class="day-card expanded mt-4">
        <div class="day-header">
          <span class="day-number">üöÄ</span>
          <span class="day-theme">D√©ploiement sur Render</span>
        </div>
        <div class="day-content">
          <!-- Introduction -->
          <h4 class="mt-5"><i class="fas fa-cloud"></i> Qu'est-ce que Render ?</h4>
          <p>Render est une plateforme de cloud hosting tr√®s populaire (dans la m√™me famille que Vercel, Railway, ou Fly.io) qui permet de d√©ployer gratuitement de petites APIs Node.js / Express.</p>

          <div class="highlight-box" style="background: #e8f4fd; border-left: 4px solid #0066cc;">
            <h6>üìä Fonctionnalit√©s principales</h6>
            <ul>
              <li>‚úÖ D√©ploiement automatique depuis GitHub/GitLab</li>
              <li>‚úÖ H√©bergement gratuit avec Free Tier</li>
              <li>‚úÖ PostgreSQL gratuit inclus</li>
              <li>‚úÖ HTTPS automatique avec URL publique</li>
              <li>‚ö° Sleep mode apr√®s 15 minutes d'inactivit√© (limite du gratuit)</li>
            </ul>
          </div>

          <!-- Structure de fichiers -->
          <h4 class="mt-5"><i class="fas fa-folder"></i> Structure de base d'une API pour Render</h4>
          
          <h5 class="mt-4">1. Fichier server.js</h5>
          <pre><code class="javascript">import express from "express";
const app = express();

app.use(express.json());

app.get("/", (req, res) => {
  res.json({ message: "API en ligne via Render üöÄ" });
});

app.get("/api/status", (req, res) => {
  res.json({ 
    status: "ok", 
    timestamp: new Date().toISOString(),
    environment: process.env.NODE_ENV || "development"
  });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`Serveur d√©marr√© sur le port ${PORT}`);
});</code></pre>

          <h5 class="mt-4">2. Fichier package.json</h5>
          <pre><code class="json">{
  "name": "smartcity-api",
  "version": "1.0.0",
  "type": "module",
  "scripts": {
    "start": "node server.js",
    "dev": "node --watch server.js"
  },
  "dependencies": {
    "express": "^4.19.2",
    "dotenv": "^16.3.1"
  },
  "engines": {
    "node": ">=18.0.0"
  }
}</code></pre>

          <h5 class="mt-4">3. Fichier .env (optionnel, pour variables locales)</h5>
          <pre><code class="text">PORT=3000
NODE_ENV=development
DATABASE_URL=postgresql://user:password@localhost:5432/smartcity</code></pre>

          <!-- Guide de d√©ploiement -->
          <h4 class="mt-5"><i class="fas fa-rocket"></i> Guide de d√©ploiement √©tape par √©tape</h4>

          <h5 class="mt-4">√âtape 1 : Pr√©parer le projet</h5>
          <ol>
            <li>Cr√©ez votre API Node.js/Express localement</li>
            <li>Assurez-vous que le fichier <code>package.json</code> contient un script <code>"start"</code></li>
            <li>Testez que l'API fonctionne en local avec <code>npm start</code></li>
          </ol>

          <h5 class="mt-4">√âtape 2 : Pousser sur GitHub</h5>
          <pre><code class="bash"># Initialiser le repo si n√©cessaire
git init
git add .
git commit -m "Initial commit: API SmartCity"

# Cr√©er un repo sur GitHub, puis :
git remote add origin https://github.com/votre-username/smartcity-api.git
git branch -M main
git push -u origin main</code></pre>

          <h5 class="mt-4">√âtape 3 : D√©ployer sur Render</h5>
          <ol>
            <li>Allez sur <a href="https://render.com" target="_blank">https://render.com</a></li>
            <li>Cr√©ez un compte (gratuit avec GitHub)</li>
            <li>Cliquez sur <strong>"New"</strong> ‚Üí <strong>"Web Service"</strong></li>
            <li>Connectez votre d√©p√¥t GitHub et s√©lectionnez le projet</li>
            <li>Configurez les param√®tres :
              <ul>
                <li><strong>Name :</strong> smartcity-api (ou votre nom)</li>
                <li><strong>Environment :</strong> Node</li>
                <li><strong>Build Command :</strong> <code>npm install</code></li>
                <li><strong>Start Command :</strong> <code>npm start</code></li>
                <li><strong>Plan :</strong> Free (pour commencer)</li>
              </ul>
            </li>
            <li>Cliquez sur <strong>"Create Web Service"</strong></li>
          </ol>

          <h5 class="mt-4">√âtape 4 : Configuration des variables d'environnement</h5>
          <p>Dans les param√®tres de votre service sur Render, allez dans <strong>"Environment"</strong> et ajoutez :</p>
          <ul>
            <li><code>NODE_ENV=production</code></li>
            <li><code>DATABASE_URL</code> (si vous utilisez PostgreSQL)</li>
            <li>Toutes autres variables n√©cessaires √† votre API</li>
          </ul>

          <h5 class="mt-4">√âtape 5 : D√©ploiement automatique</h5>
          <p>D√®s que vous poussez du code sur GitHub (branche <code>main</code>), Render red√©ploie automatiquement votre API !</p>

          <!-- Exemple complet -->
          <h4 class="mt-5"><i class="fas fa-code"></i> Exemple complet : API avec route /events</h4>
          <pre><code class="javascript">import express from "express";
import cors from "cors";

const app = express();
app.use(cors());
app.use(express.json());

// Route de test
app.get("/", (req, res) => {
  res.json({ 
    message: "API SmartCity d√©ploy√©e sur Render üöÄ",
    version: "1.0.0"
  });
});

// Route m√©tier
app.get("/api/events", (req, res) => {
  res.json({
    data: [
      { id: 1, title: "Concert Jazz", date: "2025-07-15" },
      { id: 2, title: "Exposition Art", date: "2025-08-20" }
    ]
  });
});

// Gestion des erreurs 404
app.use((req, res) => {
  res.status(404).json({ error: "Route not found" });
});

const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`‚úÖ API d√©marr√©e sur le port ${PORT}`);
  console.log(`üåê URL publique: ${process.env.RENDER_EXTERNAL_URL || 'local'}`);
});</code></pre>

          <!-- Base de donn√©es PostgreSQL -->
          <h4 class="mt-5"><i class="fas fa-database"></i> Ajouter une base de donn√©es PostgreSQL</h4>
          <ol>
            <li>Dans Render, cliquez sur <strong>"New"</strong> ‚Üí <strong>"PostgreSQL"</strong></li>
            <li>Choisissez le <strong>Plan Free</strong></li>
            <li>Notez la <code>DATABASE_URL</code> g√©n√©r√©e automatiquement</li>
            <li>Dans votre Web Service, ajoutez cette URL comme variable d'environnement</li>
            <li>Installez <code>pg</code> : <code>npm install pg</code></li>
          </ol>

          <h5 class="mt-4">Exemple de connexion √† la DB</h5>
          <pre><code class="javascript">import pg from 'pg';
const { Pool } = pg;

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
  ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
});

// Test de connexion
pool.query('SELECT NOW()', (err, res) => {
  if (err) {
    console.error('‚ùå Erreur de connexion √† la DB:', err);
  } else {
    console.log('‚úÖ Connect√© √† PostgreSQL:', res.rows[0].now);
  }
});</code></pre>

          <!-- Limitations et bonnes pratiques -->
          <h4 class="mt-5"><i class="fas fa-exclamation-triangle"></i> Limitations du plan gratuit</h4>
          <div class="highlight-box" style="background: #fff4e6; border-left: 4px solid #ff9800;">
            <ul>
              <li>‚ö†Ô∏è <strong>Sleep mode :</strong> Le service s'endort apr√®s ~15 minutes d'inactivit√© (premier appel lent pour r√©veiller)</li>
              <li>‚ö†Ô∏è <strong>Ressources limit√©es :</strong> CPU et m√©moire faibles (suffisant pour les cours/d√©mos)</li>
              <li>‚ö†Ô∏è <strong>Pas de domaine custom :</strong> URL en <code>.onrender.com</code> uniquement</li>
              <li>‚ö†Ô∏è <strong>Limites de bande passante :</strong> Suffisant pour le d√©veloppement et tests</li>
            </ul>
          </div>

          <h4 class="mt-5"><i class="fas fa-check-circle"></i> Checklist de d√©ploiement</h4>
          <div class="highlight-box">
            <ul style="list-style: none; padding-left: 0;">
              <li>‚úì Le fichier <code>package.json</code> existe avec le script <code>"start"</code></li>
              <li>‚úì Le fichier d'entr√©e principal existe (ex: <code>server.js</code>)</li>
              <li>‚úì L'API √©coute sur le port d√©fini par <code>process.env.PORT</code></li>
              <li>‚úì Le projet est pouss√© sur GitHub</li>
              <li>‚úì Les variables d'environnement sont configur√©es sur Render</li>
              <li>‚úì Les d√©pendances sont list√©es dans <code>package.json</code></li>
              <li>‚úì Les CORS sont configur√©s si l'API est appel√©e depuis un frontend</li>
              <li>‚úì La gestion d'erreurs 404 est impl√©ment√©e</li>
            </ul>
          </div>

          <!-- URLs et exemples -->
          <h4 class="mt-5"><i class="fas fa-link"></i> R√©sultat attendu</h4>
          <p>Apr√®s le d√©ploiement, vous obtenez une URL publique HTTPS automatiquement :</p>
          <div class="highlight-box" style="background: #e8f5e9; border-left: 4px solid #4caf50;">
            <h6>‚úÖ Votre API est accessible √† :</h6>
            <p><code style="font-family: monospace; background: white; padding: 0.5rem; display: block; margin-top: 0.5rem;">https://smartcity-api.onrender.com</code></p>
            <p>Vous pouvez tester imm√©diatement :</p>
            <pre><code class="bash">curl https://smartcity-api.onrender.com/api/events</code></pre>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <div class="footer-logo">
            <img src="../assets/logo.jpeg" alt="YNOV Campus" class="footer-logo-img">
            <span class="footer-logo-text">Web Services</span>
          </div>
          <p class="footer-description">Ressources ‚Äî Cl√©s API & D√©ploiement.</p>
        </div>
        <div class="footer-section">
          <h3>Navigation</h3>
          <ul>
            <li><a href="../index.html#programme">Programme</a></li>
            <li><a href="../index.html#projet">Projet</a></li>
            <li><a href="resources.html">Ressources</a></li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2024 YNOV Campus. Tous droits r√©serv√©s.</p>
      </div>
    </div>
  </footer>

  <script src="../script.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      hljs.highlightAll();
    });
  </script>
</body>
</html>

